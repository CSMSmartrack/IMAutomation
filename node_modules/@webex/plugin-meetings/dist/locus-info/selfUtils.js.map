{"version":3,"sources":["selfUtils.js"],"names":["selfUtils","parse","self","deviceId","muted","getMuted","lastModified","getLastModified","modifiedBy","getModifiedBy","guest","moderator","mediaStatus","getStatus","status","state","joinedWith","devices","find","device","url","creator","isCreator","selfId","id","selfIdentity","getSelfIdentity","selfUrl","getSelves","oldSelf","newSelf","previous","current","updates","isUnadmittedGuest","isAdmittedGuest","isMutedByOthers","mutedByOthers","moderatorChanged","controls","audio","meta","person","audioStatus","video","videoStatus","slides","videoSlidesStatus","isLocusGuestUnadmitted","check","_IDLE_","isLocusGuestAdmitted","_JOINED_","ParameterError","changedSelf","getSipUrl","partner","type","sipUri","_CALL_","sipUrl","emailAddress","email"],"mappings":"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","file":"selfUtils.js","sourcesContent":["\nimport {\n  _IDLE_,\n  _JOINED_,\n  _CALL_\n} from '../constants';\nimport ParameterError from '../common/errors/parameter';\n\nconst selfUtils = {};\n\n/**\n * parses the relevant values for self: muted, guest, moderator, mediaStatus, state, joinedWith, creator, id\n * @param {Object} self\n * @param {String} deviceId\n * @returns {undefined}\n */\nselfUtils.parse = (self, deviceId) => {\n  if (self) {\n    return {\n      muted: selfUtils.getMuted(self),\n      lastModified: selfUtils.getLastModified(self),\n      modifiedBy: selfUtils.getModifiedBy(self),\n      guest: self.guest,\n      moderator: self.moderator,\n      mediaStatus: selfUtils.getStatus(self.status),\n      state: self.state,\n      // TODO: give a proper name . With same device as login or different login`\n      // Some times we might have joined with both mobile and web\n      joinedWith: self.devices.find((device) => deviceId === device.url),\n      creator: self.isCreator, // check if its used,\n      selfId: self.id,\n      selfIdentity: selfUtils.getSelfIdentity(self),\n      selfUrl: self.url\n    };\n  }\n\n  return null;\n};\n\nselfUtils.getSelves = (oldSelf, newSelf, deviceId) => {\n  const previous = oldSelf && selfUtils.parse(oldSelf, deviceId);\n  const current = newSelf && selfUtils.parse(newSelf, deviceId);\n  const updates = {};\n\n  updates.isUnadmittedGuest = selfUtils.isUnadmittedGuest(current);\n  updates.isAdmittedGuest = selfUtils.isAdmittedGuest(previous, current);\n  updates.isMutedByOthers = selfUtils.mutedByOthers(previous, current);\n  updates.moderatorChanged = selfUtils.moderatorChanged(previous, current);\n\n  return {\n    previous,\n    current,\n    updates: {\n      isUnadmittedGuest: selfUtils.isUnadmittedGuest(current),\n      isAdmittedGuest: selfUtils.isAdmittedGuest(previous, current),\n      mutedByOthers: selfUtils.mutedByOthers(previous, current)\n    }\n  };\n};\n\nselfUtils.getLastModified = (self) => {\n  if (!self || !self.controls || !self.controls.audio || !self.controls.audio.meta || !self.controls.audio.meta.lastModified) {\n    return null;\n  }\n\n  return self.controls.audio.meta.lastModified;\n};\n\nselfUtils.getModifiedBy = (self) => {\n  if (!self || !self.controls || !self.controls.audio || !self.controls.audio.meta || !self.controls.audio.meta.modifiedBy) {\n    return null;\n  }\n\n  return self.controls.audio.meta.modifiedBy;\n};\n\n/**\n * get the id from the self object\n * @param {Object} self\n * @returns {String}\n */\nselfUtils.getSelfIdentity = (self) => {\n  if (!self && !self.person) {\n    return null;\n  }\n\n  return self.person.id;\n};\n\n/**\n * get the muted property from the self object\n * @param {Object} self\n * @returns {Boolean}\n */\nselfUtils.getMuted = (self) => {\n  if (!self || !self.controls || !self.controls.audio) {\n    return null;\n  }\n\n  return self.controls.audio.muted;\n};\n\nselfUtils.getStatus = (status) => ({\n  audio: status.audioStatus,\n  video: status.videoStatus,\n  slides: status.videoSlidesStatus\n});\n\n/**\n * @param {Object} check\n * @returns {Boolean}\n */\nselfUtils.isLocusGuestUnadmitted = (check) => check && check.guest && check.state === _IDLE_;\n\n/**\n * @param {Object} check\n * @returns {Boolean}\n */\nselfUtils.isLocusGuestAdmitted = (check) => check && check.guest && check.state === _JOINED_;\n\n/**\n * @param {Object} self\n * @returns {Boolean}\n * @throws {Error} when self is undefined\n */\nselfUtils.isUnadmittedGuest = (self) => {\n  if (!self) {\n    throw new ParameterError('self must be defined to determine if self is unadmitted as guest.');\n  }\n\n  return selfUtils.isLocusGuestUnadmitted(self);\n};\n\nselfUtils.moderatorChanged = (oldSelf, changedSelf) => {\n  if (!oldSelf) {\n    return true;\n  }\n  if (!changedSelf) {\n    throw new ParameterError('New self must be defined to determine if self transitioned moderator status.');\n  }\n\n  return oldSelf.moderator !== changedSelf.moderator;\n};\n\n/**\n * @param {Object} oldSelf\n * @param {Object} changedSelf\n * @returns {Boolean}\n * @throws {Error} if changed self was undefined\n */\nselfUtils.isAdmittedGuest = (oldSelf, changedSelf) => {\n  if (!oldSelf) {\n    // if there was no previous locus, it couldn't have been admitted yet\n    return false;\n  }\n  if (!changedSelf) {\n    throw new ParameterError('New self must be defined to determine if self transitioned to admitted as guest.');\n  }\n\n  return selfUtils.isLocusGuestUnadmitted(oldSelf) && selfUtils.isLocusGuestAdmitted(changedSelf);\n};\n\nselfUtils.mutedByOthers = (oldSelf, changedSelf) => {\n  if (!changedSelf) {\n    throw new ParameterError('New self must be defined to determine if self was muted by others.');\n  }\n\n  return changedSelf.muted && (oldSelf.lastModified !== changedSelf.lastModified || oldSelf.modifiedBy !== changedSelf.modifiedBy);\n};\n\n/**\n * extract the sipUrl from the partner\n * @param {Object} partner\n * @param {Object} info\n * @returns {Object}\n */\n\nselfUtils.getSipUrl = (partner, type, sipUri) => {\n  // For webex meeting the sipUrl gets updated in info parser\n  if (partner && type === _CALL_) {\n    return {sipUri: partner.person.sipUrl || partner.person.emailAddress || partner.person.email};\n  }\n\n  return {sipUri};\n};\n\n\nexport default selfUtils;\n\n"]}