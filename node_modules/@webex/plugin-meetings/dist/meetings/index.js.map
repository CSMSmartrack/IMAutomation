{"version":3,"sources":["index.js"],"names":["Meetings","args","namespace","MEETINGS","meetingInfo","MeetingInfo","parent","webex","request","Request","meetingCollection","MeetingCollection","personalMeetingRoom","PersonalMeetingRoom","reachability","onReady","Metrics","initialSetup","version","data","meeting","getByKey","LOCUS_URL","locusUrl","CORRELATION_ID","MeetingsUtil","checkForCorrelationId","internal","device","url","locus","SIP_URI","self","callbackInfo","callbackAddress","fullState","state","LOCUS","STATE","INACTIVE","LoggerProxy","logger","warn","create","_LOCUS_ID_","then","newMeeting","eventType","LOCUSEVENT","DIFFERENCE","locusInfo","finally","postEvent","event","NOTIFICATION_RECEIVED","trigger","MERCURY_EVENT","REMOTE_STARTED","Trigger","file","function","EVENT_TRIGGERS","MEETING_ADDED","type","_MEETING_","_JOIN_","_INCOMING_","parse","envelope","MESSAGE_ROAP","handleLocusEvent","mercury","on","LOCUS_MERCURY","handleLocusMercury","ROAP","ROAP_MERCURY","handleRoapMercury","once","READY","LoggerConfig","set","config","logging","canAuthorize","listenForEvents","MEETINGS_READY","Reachability","setReachability","getReachability","gatherReachability","meetingId","response","delete","MEETING_REMOVED","destination","createMeeting","EVENTS","DESTROY_MEETING","payload","destroy","error","resolve","Meeting","userId","deviceUrl","roapSeq","fetchMeetingInfo","extractDestination","info","parseMeetingInfo","catch","err","sipUri","setSipUri","meetingAddedType","getMeetingAddedType","value","options","getAll","getActiveMeetings","loci","length","forEach","scheduled","get","StatsAnalyzer","StatsCalculator","WebexPlugin"],"mappings":"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","file":"index.js","sourcesContent":["/*!\n  * Copyright (c) 2015-2019 Cisco Systems, Inc. See LICENSE file.\n*/\n\nimport '@webex/internal-plugin-mercury';\n\nimport {WebexPlugin} from '@webex/webex-core';\n\nimport Metrics from '../metrics';\nimport {trigger, eventType} from '../metrics/config';\nimport LoggerConfig from '../common/logs/logger-config';\nimport LoggerProxy from '../common/logs/logger-proxy';\nimport Trigger from '../common/events/trigger-proxy';\nimport {\n  MEETINGS,\n  EVENTS,\n  EVENT_TRIGGERS,\n  READY,\n  LOCUSEVENT,\n  LOCUS_URL,\n  ROAP,\n  _MEETING_,\n  _JOIN_,\n  _LOCUS_ID_,\n  _INCOMING_,\n  LOCUS,\n  CORRELATION_ID,\n  SIP_URI\n} from '../constants';\nimport MeetingInfo from '../meeting-info';\nimport Meeting from '../meeting';\nimport PersonalMeetingRoom from '../personal-meeting-room';\nimport Reachability from '../reachability';\nimport Request from '../meetings/request';\nimport StatsAnalyzer from '../analyzer/analyzer';\nimport StatsCalculator from '../analyzer/calculator';\n\nimport MeetingCollection from './collection';\nimport MeetingsUtil from './util';\n\n\n/**\n   * Meetings Ready Event\n   * Emitted when the meetings instance on webex is ready\n   * @event meetings:ready\n   * @instance\n   * @memberof Meetings\n   */\n\n/**\n    * Meeting Removed Event\n    * Emitted when a meeting was removed from the cache of meetings\n    * @event meeting:removed\n    * @instance\n    * @type {Object}\n    * @property {String} meetingId the removed meeting\n    * @property {Object} response the server response\n    * @property {String} type what type of meeting it was\n    * @memberof Meetings\n    */\n\n/**\n    * Meeting Added Event\n    * Emitted when a meeting was added to the cache of meetings\n    * @event meeting:added\n    * @instance\n    * @type {Object}\n    * @property {String} meetingId the added meeting\n    * @property {String} type what type of meeting it was\n    * @memberof Meetings\n    */\n\n/**\n   * Maintain a cache of meetings and sync with services.\n   * @class\n   */\nexport default class Meetings extends WebexPlugin {\n    namespace = MEETINGS;\n\n    /**\n     * Initializes the Meetings Plugin\n     * @constructor\n     * @public\n     * @memberof Meetings\n     */\n    constructor(...args) {\n      super(...args);\n      /**\n       * The MeetingInfo object to interact with server\n       * @instance\n       * @type {Object}\n       * @private\n       * @memberof Meetings\n       */\n      this.meetingInfo = new MeetingInfo({}, {parent: this.webex});\n      /**\n       * The Meetings request to interact with server\n       * @instance\n       * @type {Object}\n       * @private\n       * @memberof Meetings\n       */\n      this.request = new Request({}, {parent: this.webex});\n      this.meetingCollection = new MeetingCollection();\n      /**\n       * The PersonalMeetingRoom object to interact with server\n       * @instance\n       * @type {Object}\n       * @public\n       * @memberof Meetings\n       */\n      this.personalMeetingRoom = new PersonalMeetingRoom({}, {parent: this.webex});\n      /**\n       * The Reachability object to interact with server, starts as null until {@link Meeting#setReachability} is called\n       * starts as null\n       * @instance\n       * @type {Object}\n       * @private\n       * @memberof Meetings\n       */\n      this.reachability = null;\n      this.onReady();\n      Metrics.initialSetup(this.meetingCollection, this.webex.version);\n    }\n\n    /**\n     * handle locus events and takes meeting actions with them as they come in\n     * @param {Object} data a locus event\n     * @param {String} data.locusUrl\n     * @param {Object} data.locus\n     * @param {String} data.eventType\n     * @returns {undefined}\n     * @private\n     * @memberof Meetings\n     */\n    handleLocusEvent(data) {\n      let meeting = null;\n\n      // getting meeting by correlationId. This will happen for the new event\n      // Either the locus\n      // TODO : Add check for the callBack Address\n      meeting = this.meetingCollection.getByKey(LOCUS_URL, data.locusUrl) ||\n      this.meetingCollection.getByKey(CORRELATION_ID, MeetingsUtil.checkForCorrelationId(this.webex.internal.device.url, data.locus)) ||\n      this.meetingCollection.getByKey(SIP_URI, data.locus.self && data.locus.self.callbackInfo && data.locus.self.callbackInfo.callbackAddress);\n\n      if (!meeting) {\n        // TODO: create meeting when we get a meeting object\n        // const checkForEnded = (locus) => {\n        // TODO: you already ended the meeting but you got an event later\n        // Mainly for 1:1 Callsor meeting\n        // Happens mainly after refresh\n\n        // 1:1 Meeting\n        // 1)  You ended a call before but you got a mercury event\n        // Make sure end the call and cleanup the meeting only if the mercury\n        // event says so\n        // 2) Maintain lastSync time in the meetings object which helps to compare\n        // If the meeting came befor or after the sync . ANy meeting start time before the sync time is invalid\n\n        // For space Meeting\n        // Check the locus object and see who has joined\n\n        // };\n        // rather then locus object change to locus url\n\n        if (data.locus && data.locus.fullState && data.locus.fullState.state === LOCUS.STATE.INACTIVE) {\n          // just ignore the event as its already ended and not active\n          LoggerProxy.logger.warn('Meetings->handleLocusEvent#Locus event received for meeting, after it was ended.');\n\n          return;\n        }\n        this.create(data.locus, _LOCUS_ID_).then((newMeeting) => {\n          meeting = newMeeting;\n\n          if (data.eventType === LOCUSEVENT.DIFFERENCE) {\n            // its a delta object and we have a new meeting\n            meeting.locusInfo.initialSetup(data.locus, meeting);\n          }\n          else {\n            // Its a new meeting and have a fresh locus object\n            meeting.locusInfo.initialSetup(data.locus);\n          }\n        })\n          .finally(() => {\n            // Had to put `meeting:added here as the parsing of the locus object is done here\n            Metrics.postEvent({event: eventType.NOTIFICATION_RECEIVED, meeting, data: {trigger: trigger.MERCURY_EVENT}});\n\n            Metrics.postEvent({event: eventType.REMOTE_STARTED, meeting, data: {trigger: trigger.MERCURY_EVENT}});\n            Trigger.trigger(\n              this,\n              {\n                file: 'meetings',\n                function: 'handleLocusEvent'\n              },\n              EVENT_TRIGGERS.MEETING_ADDED,\n              {\n                meeting,\n                type: meeting.type === _MEETING_ ? _JOIN_ : _INCOMING_\n              }\n            );\n          });\n      }\n      else {\n        Metrics.postEvent({event: eventType.NOTIFICATION_RECEIVED, meeting, data: {trigger: trigger.MERCURY_EVENT}});\n        meeting.locusInfo.parse(meeting, data);\n      }\n    }\n\n    /**\n     * handles locus events through mercury that are not roap\n     * @param {Object} envelope\n     * @param {Object} envelope.data\n     * @param {String} envelope.data.eventType\n     * @returns {undefined}\n     * @private\n     * @memberof Meetings\n     */\n    handleLocusMercury(envelope) {\n      const {data} = envelope;\n      const {eventType} = data;\n\n      if (eventType && eventType !== LOCUSEVENT.MESSAGE_ROAP) {\n        this.handleLocusEvent(data);\n      }\n    }\n\n    /**\n     * registers for locus and roap mercury events\n     * @returns {undefined}\n     * @private\n     * @memberof Meetings\n     */\n    listenForEvents() {\n      this.webex.internal.mercury.on(LOCUSEVENT.LOCUS_MERCURY, (envelope) => {\n        this.handleLocusMercury(envelope);\n      });\n      this.webex.internal.mercury.on(ROAP.ROAP_MERCURY, (envelope) => {\n        MeetingsUtil.handleRoapMercury(envelope, this.meetingCollection);\n      });\n    }\n\n    /**\n     * @returns {undefined}\n     * @private\n     * @memberof Meetings\n     */\n    onReady() {\n      this.webex.once(READY, () => {\n        LoggerConfig.set(this.config.logging);\n        LoggerProxy.set(this.webex.logger);\n        if (this.webex.canAuthorize) {\n          this.listenForEvents();\n          // this.listenInternal();\n          Trigger.trigger(\n            this,\n            {\n              file: 'meetings',\n              function: 'onReady'\n            },\n            EVENT_TRIGGERS.MEETINGS_READY\n          );\n        }\n      });\n    }\n\n    /**\n     * initializes the reachability instance for Meetings\n     * @returns {undefined}\n     * @public\n     * @memberof Meetings\n     */\n    setReachability() {\n      this.reachability = new Reachability({}, {parent: this.webex});\n    }\n\n    /**\n     * gets the reachability instance for Meetings\n     * @returns {Reachability}\n     * @public\n     * @memberof Meetings\n     */\n    getReachability() {\n      return this.reachability;\n    }\n\n    /**\n     * initializes and starts gathering reachability for Meetings\n     * @returns {undefined}\n     * @public\n     * @memberof Meetings\n     */\n    startReachability() {\n      if (!this.reachability) {\n        this.setReachability();\n      }\n      this.getReachability().gatherReachability();\n    }\n\n    /**\n     * gets the personal meeting room instance, for saved PMR values for this user\n     * @returns {PersonalMeetingRoom}\n     * @public\n     * @memberof Meetings\n     */\n    getPersonalMeetingRoom() {\n      return this.personalMeetingRoom;\n    }\n\n    /**\n     * @param {String} meetingId\n     * @param {Object} response\n     * @param {String} type\n     * @returns {Object}\n     * @private\n     * @memberof Meetings\n     */\n    destroy(meetingId, response) {\n      this.meetingCollection.delete(meetingId);\n      Trigger.trigger(\n        this,\n        {\n          file: 'meetings',\n          function: 'destroy'\n        },\n        EVENT_TRIGGERS.MEETING_REMOVED,\n        {\n          meetingId,\n          response\n        }\n      );\n\n      return response;\n    }\n\n    /**\n     * Create a meeting.\n     * @param {string} destination - sipURL, spaceId, phonenumber, meeting link, or locus object}\n     * @param {string} [type] - the optional specified type, such as locusId\n     * @returns {Promise} A new Meeting.\n     * @public\n     * @memberof Meetings\n     */\n    create(destination, type = null) {\n      // TODO: type should be from a dictionary\n      // Check if there is already meeting\n      const meeting = this.meetingCollection.getByKey(SIP_URI, destination);\n\n      if (!meeting) {\n        return this.createMeeting(destination, type)\n          .then((meeting) => {\n            if (meeting && meeting.on) {\n              meeting.on(EVENTS.DESTROY_MEETING, (payload) => {\n                this.destroy(payload.meetingId, payload.response);\n              });\n            }\n            else {\n              LoggerProxy.logger.error(`meetings->create#ERROR, meeting does not have on method, will not be destroyed, meeting cleanup impossible for meeting: ${meeting}`);\n            }\n\n            return Promise.resolve(meeting);\n          });\n      }\n\n      return Promise.resolve(meeting);\n    }\n\n    /**\n     * @param {String} destination see create()\n     * @param {String} type see create()\n     * @returns {Promise} a new meeting instance complete with meeting info and destination\n     * @private\n     * @memberof Meetings\n     */\n    createMeeting(destination, type = null) {\n      const meeting = new Meeting(\n        {\n          userId: this.webex.internal.device.userId,\n          deviceUrl: this.webex.internal.device.url,\n          roapSeq: 0,\n          locus: type === _LOCUS_ID_ ? destination : null // pass the locus object if present\n        },\n        {\n          parent: this.webex\n        }\n      );\n\n      this.meetingCollection.set(meeting);\n\n      return this.meetingInfo\n        .fetchMeetingInfo(MeetingsUtil.extractDestination(destination, type), type)\n        .then((info) => {\n          meeting.parseMeetingInfo(info);\n          meeting.meetingInfo = info;\n\n          return meeting;\n        })\n        .catch((err) => {\n          LoggerProxy.logger.error(`Meetings->createMeeting#Error ${err} fetching /meetingInfo for creation, continuing.`);\n          // if there is no meeting info we assume its a 1:1 call or wireless share\n          // We need to save this info for future reference\n          meeting.destination = destination;\n\n          return meeting;\n        })\n        .finally(() => {\n          // For type LOCUS_ID we need to parse the locus object to get the information\n          // about the caller and callee\n          // TODO: check for a better solution\n          if (type === _LOCUS_ID_) {\n            return;\n          }\n\n          if (!meeting.sipUri) {\n            meeting.setSipUri(destination);\n          }\n          // TODO: check if we have to move this to parser\n          const meetingAddedType = MeetingsUtil.getMeetingAddedType(type);\n\n          // We typically shouldn't need to trigger both and event and return a promise.\n          // Is this a special case? We want to make the public API usage as simple as possible.\n          Trigger.trigger(\n            this,\n            {\n              file: 'meetings',\n              function: 'createMeeting'\n            },\n            EVENT_TRIGGERS.MEETING_ADDED,\n            {\n              meeting,\n              type: meetingAddedType\n            }\n          );\n        });\n\n      // Create the meeting calling the necessary service endpoints.\n\n      // Internally, there are many more destinations:\n      //\n      // - locusID\n      // - meetingURL\n      // - globalMeetingID, e.g, *00*meetingID\n      // - meetingID\n      // - meetingURL\n      // - PSTN\n      // - phone number\n      //\n      // Our job is to determine the appropriate one\n      // and its corresponding service so that developers\n      // need only sipURL or spaceID to get a meeting\n      // and its ID, but have the option to use createWithType()\n      // and specify those types to get meetingInfo\n    }\n\n    /**\n     * get a specifc meeting given it's type matched to the value, i.e., locus url\n     * @param {String} type\n     * @param {Object} value\n     * @returns {Meeting}\n     * @public\n     * @memberof Meetings\n     */\n    getMeetingByType(type, value) {\n      return this.meetingCollection.getByKey(type, value);\n    }\n\n    /**\n     * Get all meetings.\n     * @param {object} options\n     * @param {object} options.startDate - get meetings after this start date\n     * @param {object} options.endDate - get meetings before this end date\n     * @returns {Object} All active and scheduled meetings.\n     * @public\n     * @memberof Meetings\n     */\n    getAllMeetings(options = {}) {\n      // Options may include other parameters to filter this collection\n      // of meetings.\n      return this.meetingCollection.getAll(options);\n    }\n\n    /**\n     * syncs all the meeting from server\n     * @returns {undefined}\n     * @public\n     * @memberof Meetings\n     */\n    syncMeetings() {\n      return this.request.getActiveMeetings().then((locus) => {\n        if (locus.loci && locus.loci.length > 0) {\n          locus.loci.forEach((locus) => {\n            this.handleLocusEvent({\n              locus,\n              locusUrl: locus.url\n            });\n          });\n        }\n      });\n    }\n\n    /**\n     * Get all scheduled meetings.\n     * @param {object} options\n     * @param {object} options.startDate - get meetings after this start date\n     * @param {object} options.endDate - get meetings before this end date\n     * @returns {Object} All scheduled meetings.\n     * @memberof Meetings\n     */\n    getScheduledMeetings() {\n      return this.meetingCollection.getAll({scheduled: true});\n    }\n\n    /**\n     * Get the logger instance for plugin-meetings\n     * @returns {Logger}\n     */\n    getLogger() {\n      return LoggerProxy.get();\n    }\n\n    /**\n     * Get the Stats Analyzer singleton\n     * @returns {StatsAnalyzer}\n     * @public\n     * @memberof Meetings\n     */\n    getAnalyzer() {\n      return StatsAnalyzer;\n    }\n\n    /**\n     * Get the Stats Calculator singleton\n     * @returns {StatsCalculator}\n     * @public\n     * @memberof Meetings\n     */\n    getCalculator() {\n      return StatsCalculator;\n    }\n}\n"]}